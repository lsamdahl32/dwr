let editModeScripts=function(e,t){let i,o,n,d={},a=!1;function l(e){"function"==typeof window[t.modeCallback]&&window[t.modeCallback](t.mode,t.curId)}function r(){t.editmode=!1,$("#new_password_span").length&&closePasswordForm(),$("#btnClose"+e).click()}function c(n){$(".form_error").html(""),$("#timeoutWarning"+e).hide(),clearTimeout(i),clearTimeout(o),$(window).off("unload.recordlocking"),$(window).off("beforeunload"),a=!1,u(),t.noProfileMode?(t.mode="list",l(t.mode),$("#"+e+"-edit").hide(n),$("#"+e+"-report").show(n)):($(".editMode"+e).hide(n),t.editModeNoColumns&&$("#profile-flex-cols"+e).css("display","flex"),$(".readMode"+e).show(n),$("#new_password_span").length&&closePasswordForm(),$("#profileHeading"+e).html(t.subTitle),t.mode="view",$("#ReturntoSearchResults").show(),l(t.mode))}function s(t){t?($("#hideProfile"+e).hide(400),$("#hideProfileView"+e).html('<i class="bi-arrows-expand"></i>&nbsp;Show').attr("title","Show Profile Section")):($("#hideProfile"+e).show(400),$("#hideProfileView"+e).html('<i class="bi-arrows-collapse"></i>&nbsp;Hide').attr("title","Hide Profile Section"))}function u(){$.post(t.ajaxPath+"admin_ajax.php",{process:"unlockRecord",db:t.DB,table:t.table,keyname:t.keyField,id:t.curId,requireSameUser:!0},function(e){})}function f(i){let o="btnDelete"+e+"="+t.curId+"&rm_process=deleteRecord&identifier="+e+"&linkID="+t.curId;$.post(t.self,o,function(e){checkLoginStatus(e);var i=JSON.parse(e);"object"==typeof i&&("Success"===i.result?(a=!1,jqAlert(i.msg),t.mode="list",l(t.mode)):e.length>0&&p(i.msg))})}function m(){$(window).on("beforeunload",function(){return"Changes you made may not be saved."}),"edit"===t.mode&&t.useLocking&&(clearTimeout(i),i=setTimeout(function(){a=!1,r()},1e3*t.timeout),$("#timeoutWarning"+e).hide(),clearTimeout(o),o=setTimeout(function(){$("#timeoutWarning"+e).show(400)},1e3*t.warningTimeout),$.post(t.ajaxPath+"admin_ajax.php",{process:"resetRecordLockTime",db:t.DB,table:t.table,keyname:t.keyField,id:t.curId},function(e){checkLoginStatus(e),"1"==e?$(window).on("unload.recordlocking",function(){t.editmode&&$.post(t.ajaxPath+"admin_ajax.php",{process:"unlockRecord",db:t.DB,table:t.table,keyname:t.keyField,id:t.curId,requireSameUser:!0},function(e){})}):t.editmode&&($("#alertOK").on("click",function(){$("#alertOK").off(),r()}),jqAlert("Your record lock has been lost. Edit mode is cancelled. Please contact IT if this happens regularly."))}))}function p(t){$("#saveMessage"+e).html(t).show(400).get(0).scrollIntoView(),clearTimeout(n),n=setTimeout(function(){$("#saveMessage"+e).hide(400)},1e4)}function h(i,o){"function"==typeof window[t.customProfileCallback]?window[t.customProfileCallback](i):Object.keys(i).forEach(function(t){$("#profile-flex-cols"+e+" #"+t+"_rmc").html(i[t])}),"function"==typeof o&&o(i)}function b(i,o){$.post(t.self,{rm_process:"getEditPage",identifier:e,id:t.curId,linkField:t.parKeyField,linkID:t.parId,mode:i},function(t){checkLoginStatus(t);var i=JSON.parse(t);Object.keys(i).forEach(function(t){$(".editModeInputs"+e).each(function(){if($(this).attr("data-field")===t&&($(this).html(i[t]),i[t].toString().indexOf("mceEditor")>0)){var e,o,n;let l,r=(e=$(this).children("textarea")[0],o=d.allowDark&&window.matchMedia("(prefers-color-scheme: dark)").matches?"oxide-dark":"",n="",d.allowDark&&(n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":""),""!==d.content_css&&(n=""!==n?"("+n+", "+d.content_css+")":d.content_css),l={target:e,width:d.width,height:d.height,plugins:d.plugins,menu:d.menu,menubar:d.menubar,toolbar:d.toolbar,toolbar_drawer:d.toolbar_drawer,templates:d.templates,fontsize_formats:"8pt 10pt 11pt 12pt 14pt 18pt 24pt 36pt",setup:function(e){e.on("change",function(t){e.save(),a=!0}).on("keyup",function(e){m()})},branding:!1,skin:o,readonly:d.readonly},""!==n&&(l.content_css=n),Object.assign(l,d.extra));tinymce.init(r)}})}),void 0!==o&&o(i)})}function g(e){var t=new Date(e),i=""+(t.getMonth()+1),o=""+t.getDate(),n=t.getFullYear();return i.length<2&&(i="0"+i),o.length<2&&(o="0"+o),[n,i,o].join("-")}function k(e){$("#stateZone").length&&($("#stateZone").find("option").remove(),$.post(t.ajaxPath+"admin_ajax.php",{process:"getRecords",db:"tshop",select:"SELECT z.* FROM `zc_zones` z INNER JOIN `zc_countries` c ON c.`countries_id` = z.`zone_country_id` ",where:"`countries_name` = ?",bindtypes:"s",bindvalues:e,order:"zone_name"},function(e){if(checkLoginStatus(e),"Success"===e.substring(0,7)){var t=JSON.parse(e.substring(8));$("#stateZone").append("<option disabled selected >Please Select</option>"),t.forEach(function(e,t){$("#state").val()===e.zone_code?$("#stateZone").append('<option value="'+e.zone_code+'" selected >'+e.zone_name+"</option>"):$("#stateZone").append('<option value="'+e.zone_code+'">'+e.zone_name+"</option>")}),$("#stateZone").show(),$("#state").get(0).type="hidden"}else $("#stateZone").hide(),$("#state").get(0).type="text"}))}return $("#editRecord"+e).on("click",function(){t.mode="edit",t.editmode=!0,t.noProfileMode&&t.allowDelete&&$("#btnDeleteEdit"+e).show(),$("#duplicatebutton"+e).length>0&&$("#duplicatebutton"+e).show(),b("edit",function(){$(".readMode"+e).hide(400),t.editModeNoColumns&&$("#profile-flex-cols"+e).css("display","block"),$("#stateZone").length&&k($("#countrySelect").val()),$("#ReturntoSearchResults").hide(),$(".editMode"+e).show(400),l(t.mode),m()}),$("#profileHeading"+e).html("Edit "+t.editTitle)}),$("#btnClose"+e).on("click",function(){let e=t.mode;"edit"!==e&&"add"!==e||t.noProfileMode?c(400):(c(400),"add"===e&&(t.mode="list",l(t.mode)))}),$("#hideProfileView"+e).on("click",function(){$("#hideProfile"+e).is(":visible")?s(!0):s(!1)}),$(".refreshProfile").on("click",function(){$.post(t.self,{rm_process:"getProfile",identifier:e,id:t.curId},function(e){checkLoginStatus(e);h(JSON.parse(e),window[rmRefreshCallback])})}),$("#saveAddNew"+e).on("click",function(){$("<input type='hidden' value='1' />").attr("name","saveAndAddNew").appendTo("#myEditForm"+e),$("#btnSubmit"+e).click()}),$("#btnDeleteView"+e).on("click",function(){var e=$(this).attr("data-id"),t="Record";$("#confirmText1").html("Delete "+t),jqConfIcon("Erase"),$("#delSerialsText").html("Are you sure you want to delete this "+t+"?"),$("#doConfirmAction").val("Delete").on("click.delete",function(){$("#doConfirmAction").off("click.delete"),f(e)}),$("#jqConfDialog").jqmShow()}),$("#btnDeleteEdit"+e).on("click",function(){var e=$(this).attr("data-id"),i=t.editTitle;$("#confirmText1").html("Delete "+i),jqConfIcon("Erase"),$("#delSerialsText").html("Are you sure you want to delete this "+i+"?"),$("#doConfirmAction").val("Delete").on("click.delete",function(){$("#doConfirmAction").off("click.delete"),f(e)}),$("#jqConfDialog").jqmShow()}),$("#resetTimeout"+e).on("click",function(){$("#timeoutWarning"+e).hide(),m()}),$("form#myEditForm"+e).submit(function(n){if($(".form_error").html(""),n.preventDefault(),a){let d=!1;"add"===t.mode&&(d=!0),$("#"+t.keyField+"_"+e+"e").val(t.curId),$("#linkID"+e).val(t.curId);let s=$("form#myEditForm"+e).serialize()+"&btnSubmit"+e+"=true&rm_process=saveRecord&identifier="+e+"&mode"+e+"="+t.mode;$.post(t.self,s,function(n){checkLoginStatus(n);var r=JSON.parse(n);if("object"==typeof r){if(d&&(t.curId=r[t.keyField],$("#"+t.keyField+"_"+e+"e").val(t.curId)),clearTimeout(i),clearTimeout(o),$(window).off("unload.recordlocking",function(){}),a=!1,u(),p(r.msg),"function"==typeof window[t.updateCallback]&&window[t.updateCallback](r),h(r,window[rmRefreshCallback]),"saveAddNew"===$(document.activeElement).prop("name")){let s={};s["editLinkID"+e]=t.curId,s.saveAndAddNew=1,s["btnAdd"+e]=1,d=!0,t.curId=0,t.mode="add",l(t.mode),b("add")}else!t.saveReturnsToEdit||d?(t.editmode=!1,t.noProfileMode?(c(400),t.mode="list",l(t.mode),$("#"+e+"-edit").hide(),$("#"+e+"-report").show()):c(400)):d&&($("#profileHeading"+e).html("Edit "+t.editTitle),d=!1,t.mode="edit",l(t.mode),m())}else{var r=JSON.parse(n);"object"==typeof r&&(p(r.msg),Object.keys(r).forEach(function(t){$("#"+t+"_"+e+"e_err").html(r[t])}))}})}else p("No changes were made."),t.saveReturnsToEdit||(t.editmode=!1,r())}),$("#duplicatebutton"+e).on("click",function(){a=!0,t.mode="add",addmode=!0;let n=$("form#myEditForm"+e).serialize()+"&duplicatebutton=Duplicate&rm_process=saveRecord&identifier="+e+"&mode"+e+"="+t.mode;$.post(t.self,n,function(n){checkLoginStatus(n);var d=JSON.parse(n);"object"==typeof d&&(addmode&&(t.curId=d[t.keyField],$("#"+t.keyField+"_"+e+"e").val(t.curId)),clearTimeout(i),clearTimeout(o),$(window).off("unload.recordlocking",function(){}),a=!1,u(),p(d.msg),"function"==typeof window[t.updateCallback]&&window[t.updateCallback](d),h(d,window[rmRefreshCallback]),t.editmode=!1,t.noProfileMode?(c(400),t.mode="list",l(t.mode),$("#"+e+"-edit").hide(),$("#"+e+"-report").show()):c(400))})}),$("#myEditForm"+e).on("keyup","textarea",function(){a=!0,t.useLocking&&m()}).on("change","input, select, textarea",function(){a=!0,"edit"===t.mode&&t.useLocking&&m()}).on("change","#countrySelect",function(){k(this.value)}).on("change","#stateZone",function(){$("#state").val(this.value)}).on("click",".multiSelectRemove",function(){var t=$(this).attr("data-identifier"),i=$(this).attr("data-id");$("#multiSelect_Item_"+t+"_"+i).remove();var o=$("#multiSelect_"+t+"_"+e+"e");0===o.html().trim().length&&o.html("No items found."),a=!0}).on("change",".multiSelect_Add",function(i){var o=$(this).attr("data-identifier"),n={db:$(this).attr("data-db"),sourceTable:$(this).attr("data-sourceTable"),sourceField:$(this).attr("data-sourceField"),displayField:$(this).attr("data-displayField"),field:$(this).attr("data-field")},d=$(this).find(":selected").val();d>0&&($.post(t.ajaxPath+"admin_ajax.php?process=lookupRecord",{table:n.sourceTable,db:n.db,keyField:n.sourceField,key:d},function(t){checkLoginStatus(t);let i=JSON.parse(t);if("Success"===i.response){let l=i.row;if(0===$("#multiSelect_Item_"+o+"_"+d).length){var r=$("#multiSelect_"+o+"_"+e+"e");"No items found."===r.html()&&r.html(""),r.append("<div class='multiSelect_items' id='multiSelect_Item_"+o+"_"+d+"'    data-db='"+n.db+"' data-identifier='"+o+"' data-sourceTable='"+n.sourceTable+"' data-sourceField='"+n.sourceField+"' data-displayField='"+n.displayField+"' data-field='"+n.field+"' ><button class='buttonBar multiSelectRemove' type='button' data-identifier='"+o+"' data-id='"+d+"' style='width: 16px; height: 16px;' title='Remove this item from this record.'><i class=\"bi-trash\" style=\"font-size: 14px;\"></i></button>&nbsp;"+l[n.displayField]+"<input type='hidden' name='"+n.field+"[]' value='"+d+"' /></div>"),a=!0;let c=document.querySelector(".multiSelectList");[...c.children].sort((e,t)=>e.innerText>t.innerText?1:-1).forEach(e=>c.appendChild(e)),$(".multiSelectList").trigger({type:"itemAdded",item:l[n.displayField]})}}else alert(t)}),$(this).val(0))}),{settings:t,getIdentifier:e,timeoutReset:function(){m()},setMode:function(e){t.mode=e,l(e)},getDirty:function(){return a},setDirty:function(e){(a=e)||$(window).off("beforeunload")},closeEdit:function(){c(400)},getCurrentID:function(){return t.curId},setCurrentID:function(e){t.curId=e},getParID:function(){return t.parId},setParID:function(e){t.parId=e},hideProfile:function(e){s(e)},countryChange(e){k(e)},refresh:function(i){"view"===t.mode?($("#addComment"+e).hide(),$.post(t.self,{rm_process:"getProfile",identifier:e,id:t.curId},function(e){h(JSON.parse(e),i)})):"edit"===t.mode?($(".readMode"+e).hide(400),t.editModeNoColumns&&$("#profile-flex-cols"+e).css("display","block"),$("#addComment"+e).hide(),$("#profileHeading"+e).html("Edit "+t.editTitle),t.noProfileMode&&t.allowDelete&&$("#btnDeleteEdit"+e).show(),$("#duplicatebutton"+e).length>0&&$("#duplicatebutton"+e).show(),m(),b("edit",i)):($(".readMode"+e).hide(400),t.editModeNoColumns&&$("#profile-flex-cols"+e).css("display","block"),$("#addComment"+e).show(),$("#btnDeleteEdit"+e).hide(),$("#duplicatebutton"+e).hide(),$(".editMode"+e).show(400),$("#profileHeading"+e).html("Add "+t.editTitle),b("add",i))},setTinySettings:function(e){d=e}}};function doFixPath(e){var t=$("#"+e).val();t.indexOf("/data/")>0&&$("#"+e).val(t.substring(t.indexOf("/data/"),999)).trigger("change"),$("#"+e+"_preview").length&&$("#"+e+"_preview").html("<img src='"+$("#"+e).val()+"' style='max-width: 700px;'>")}